<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamWeaver AI Image Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Purple to Blue Gradient Background */
            background: linear-gradient(to right, #6a05ad, #203378); /* Deep Purple to Dark Blue */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #ffffff; /* White text for contrast */
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }
        .container {
            background-color: rgba(255, 255, 255, 0.1); /* Slightly transparent white for content area */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
            animation: fadeIn 1s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        textarea {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(0, 0, 0, 0.2);
            color: #ffffff;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            transition: all 0.3s ease;
        }
        textarea:focus {
            outline: none;
            border-color: #a78bfa; /* Purple-ish glow on focus */
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.5);
        }
        select, button {
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        select {
            background-color: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            appearance: none; /* Remove default dropdown arrow */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ffffff%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-6.4H18.6c-5%200-9.3%201.8-13.2%205.4A17.6%2017.6%200%200%200%200%2082.2c0%203.8%201.5%207.2%204.5%2010.5L124.7%20286.3c3%203%206.4%204.5%2010.5%204.5s7.5-1.5%2010.5-4.5L287%2092.7c3-3.3%204.5-6.7%204.5-10.5%200-3.8-1.5-7.2-4.5-10.5z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 15px auto;
        }
        select:hover {
            border-color: #a78bfa;
        }
        button {
            border: none;
            background: linear-gradient(to right, #a78bfa, #8b5cf6); /* Purple button gradient */
            color: white;
            flex-grow: 1;
        }
        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .image-card {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        .image-card img {
            width: 100%;
            height: 200px; /* Fixed height for image previews */
            object-fit: cover;
            display: block;
            border-radius: 10px 10px 0 0;
        }
        .image-card .placeholder {
            width: 100%;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            border-radius: 10px 10px 0 0;
        }
        .image-card p {
            padding: 10px;
            font-size: 0.8rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid #a78bfa; /* Purple spinner */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Message Box Styling */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        .message-box.active {
            opacity: 1;
            visibility: visible;
        }
        .message-box button {
            margin-top: 20px;
            background: #8b5cf6; /* A slightly darker purple for the message box button */
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
        }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            h1 {
                font-size: 3rem;
            }
            .button-group {
                flex-direction: row;
            }
            .container {
                max-width: 800px; /* Wider for tablets and desktops */
            }
        }
        @media (min-width: 1024px) {
            .container {
                max-width: 1000px; /* Even wider for large desktops */
            }
            .image-gallery {
                grid-template-columns: repeat(4, 1fr); /* 4 images per row on large screens */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DreamWeaver AI Image Generator</h1>

        <textarea id="promptInput" placeholder="Enter your creative prompt here..."></textarea>

        <div class="flex flex-col md:flex-row gap-4 items-center">
            <select id="styleSelect" class="w-full md:w-auto">
                <option value="Auto">Auto</option>
                <option value="Realistic">Realistic</option>
                <option value="Digital Art">Digital Art</option>
                <option value="Painting">Painting</option>
                <option value="Anime">Anime</option>
                <option value="3D Render">3D Render</option>
                <option value="Minimalist">Minimalist</option>
                <option value="Black & White">Black & White</option>
                <option value="Sketch">Sketch</option>
            </select>
            <div class="flex flex-col md:flex-row gap-4 w-full">
                <button id="generateBtn">Generate Images</button>
                <button id="enhancePromptBtn" class="btn-secondary">Enhance Prompt</button>
                <button id="randomPromptBtn" class="btn-secondary">Random Prompt</button>
            </div>
        </div>

        <div id="imageGallery" class="image-gallery mt-8">
            <!-- Image cards will be inserted here by JavaScript -->
            <div class="image-card">
                <div class="placeholder">Generated image 1</div>
            </div>
            <div class="image-card">
                <div class="placeholder">Generated image 2</div>
            </div>
            <div class="image-card">
                <div class="placeholder">Generated image 3</div>
            </div>
            <div class="image-card">
                <div class="placeholder">Generated image 4</div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Message Box -->
    <div id="messageBox" class="message-box">
        <p id="messageText"></p>
        <button id="messageBoxCloseBtn">OK</button>
    </div>

    <script>
        const promptInput = document.getElementById('promptInput');
        const styleSelect = document.getElementById('styleSelect');
        const generateBtn = document.getElementById('generateBtn');
        const enhancePromptBtn = document.getElementById('enhancePromptBtn');
        const randomPromptBtn = document.getElementById('randomPromptBtn');
        const imageGallery = document.getElementById('imageGallery');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxCloseBtn = document.getElementById('messageBoxCloseBtn');

        const apiKey = ""; // Canvas will automatically provide this in runtime. Do NOT modify.

        const randomPrompts = [
            "A futuristic city at sunset, neon lights reflecting on wet streets, flying cars.",
            "A majestic dragon soaring above a fantasy castle, a brave knight on a horse below.",
            "An astronaut planting a flag on a newly discovered alien planet, vibrant flora.",
            "A serene Japanese garden with cherry blossoms, a koi pond, and a stone lantern.",
            "A cozy, cluttered wizard's study, filled with ancient books, potions, and magical artifacts.",
            "Underwater city with glowing bioluminescent creatures and coral reefs.",
            "A cyberpunk ninja jumping across rooftops in a rain-soaked metropolis.",
            "A whimsical treehouse village nestled in a giant enchanted forest.",
            "An epic space battle between two fleets of starships, explosions in the void.",
            "A lone cowboy riding through a vast desert at dusk, silhouetted against a colorful sky."
        ];

        // Function to show custom message box
        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.add('active');
        }

        // Function to hide custom message box
        messageBoxCloseBtn.addEventListener('click', () => {
            messageBox.classList.remove('active');
        });

        // Function to show loading overlay
        function showLoading() {
            loadingOverlay.classList.add('active');
        }

        // Function to hide loading overlay
        function hideLoading() {
            loadingOverlay.classList.remove('active');
        }

        // --- Image Generation Logic ---
        generateBtn.addEventListener('click', async () => {
            const prompt = promptInput.value.trim();
            const selectedStyle = styleSelect.value;

            if (!prompt) {
                showMessage("Please enter a prompt before generating images.");
                return;
            }

            showLoading();
            imageGallery.innerHTML = ''; // Clear previous images

            // Construct the prompt with the selected style
            let fullPrompt = prompt;
            if (selectedStyle !== "Auto") {
                fullPrompt = `${prompt}, in ${selectedStyle} style`;
            }

            try {
                // Prepare the payload for Imagen API
                const payload = {
                    instances: { prompt: fullPrompt },
                    parameters: { sampleCount: 4 } // Request 4 images
                };

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.predictions && result.predictions.length > 0) {
                    result.predictions.forEach((prediction, index) => {
                        if (prediction.bytesBase64Encoded) {
                            const imageUrl = `data:image/png;base64,${prediction.bytesBase64Encoded}`;
                            const imageCard = `
                                <div class="image-card">
                                    <img src="${imageUrl}" alt="Generated Image ${index + 1}">
                                    <p>Image ${index + 1}</p>
                                </div>
                            `;
                            imageGallery.innerHTML += imageCard;
                        }
                    });
                } else {
                    showMessage("Failed to generate images. No predictions found.");
                    console.error("Image generation failed:", result);
                }
            } catch (error) {
                showMessage("An error occurred during image generation. Please try again.");
                console.error("Error generating images:", error);
            } finally {
                hideLoading();
            }
        });

        // --- Enhance Prompt Logic ---
        enhancePromptBtn.addEventListener('click', async () => {
            const currentPrompt = promptInput.value.trim();

            if (!currentPrompt) {
                showMessage("Please enter a prompt to enhance.");
                return;
            }

            showLoading();

            try {
                const chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Enhance this image generation prompt, making it more descriptive and imaginative, focusing on visual details: "${currentPrompt}"` }] });
                const payload = { contents: chatHistory };

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const enhancedText = result.candidates[0].content.parts[0].text;
                    promptInput.value = enhancedText;
                    showMessage("Prompt enhanced successfully!");
                } else {
                    showMessage("Failed to enhance prompt. Please try again.");
                    console.error("Prompt enhancement failed:", result);
                }
            } catch (error) {
                showMessage("An error occurred during prompt enhancement. Please try again.");
                console.error("Error enhancing prompt:", error);
            } finally {
                hideLoading();
            }
        });

        // --- Random Prompt Logic ---
        randomPromptBtn.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * randomPrompts.length);
            promptInput.value = randomPrompts[randomIndex];
            showMessage("Random prompt loaded!");
        });

        // Set initial state for placeholders on load
        document.addEventListener('DOMContentLoaded', () => {
            // No initial images to load, placeholders are already in HTML
        });
    </script>
</body>
</html>
