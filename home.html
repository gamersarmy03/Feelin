<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamWeaver</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Purple to blue mix gradient */
            background: linear-gradient(to right bottom, #8A2BE2, #4169E1); /* Purple to Royal Blue */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem; /* Padding for mobile view */
        }
        .container {
            background-color: rgba(255, 255, 255, 0.95); /* Slightly transparent white */
            backdrop-filter: blur(10px);
            border-radius: 20px; /* Rounded corners for the main container */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 2rem;
            max-width: 1200px; /* Max width for desktop */
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            animation: fadeIn 1s ease-out; /* Fade in animation */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn {
            @apply px-6 py-3 rounded-full font-semibold text-white transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-opacity-50;
        }
        .btn-primary {
            @apply bg-gradient-to-r from-purple-600 to-blue-500 hover:from-purple-700 hover:to-blue-600 focus:ring-purple-300;
        }
        .btn-secondary {
            @apply bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 focus:ring-gray-300;
        }
        .input-field {
            @apply w-full p-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors duration-200;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .image-item {
            @apply relative w-full h-48 sm:h-64 md:h-72 lg:h-80 bg-gray-200 rounded-lg overflow-hidden flex items-center justify-center text-gray-500 text-sm animate-pulse; /* Placeholder animation */
            transition: transform 0.3s ease-in-out;
        }
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: imageLoad 0.5s ease-out forwards; /* Image load animation */
        }
        @keyframes imageLoad {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        /* Spinner animation */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal styling */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal.show .modal-content {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-6 tracking-wide">DreamWeaver</h1>

        <div class="input-section mb-6">
            <textarea id="promptInput" rows="4" class="input-field mb-4 placeholder-gray-500" placeholder="Enter your creative prompt here..."></textarea>

            <div class="flex flex-col sm:flex-row items-center gap-4 mb-4">
                <select id="styleSelect" class="input-field flex-grow">
                    <option value="auto">Auto</option>
                    <option value="realistic">Realistic</option>
                    <option value="digital art">Digital Art</option>
                    <option value="painting">Painting</option>
                    <option value="anime">Anime</option>
                    <option value="3d render">3D Render</option>
                    <option value="minimalist">Minimalist</option>
                    <option value="black & white">Black & White</option>
                    <option value="sketch">Sketch</option>
                </select>
                <button id="enhancePromptBtn" class="btn btn-secondary w-full sm:w-auto">Enhance Prompt</button>
                <button id="randomPromptBtn" class="btn btn-secondary w-full sm:w-auto">Random Prompt</button>
            </div>

            <button id="generateBtn" class="btn btn-primary w-full py-4 text-xl">Generate Images</button>
        </div>

        <div id="loadingIndicator" class="hidden flex justify-center items-center py-8">
            <div class="spinner"></div>
            <p class="ml-4 text-lg text-gray-700">Generating your dreams...</p>
        </div>

        <div id="imageGrid" class="image-grid">
            <!-- Image placeholders or generated images will go here -->
            <div class="image-item">Generating...</div>
            <div class="image-item">Generating...</div>
            <div class="image-item">Generating...</div>
            <div class="image-item">Generating...</div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <p id="modalMessage" class="text-lg text-gray-800 mb-4"></p>
            <button id="closeModalBtn" class="btn btn-primary">OK</button>
        </div>
    </div>

    <script>
        const promptInput = document.getElementById('promptInput');
        const styleSelect = document.getElementById('styleSelect');
        const enhancePromptBtn = document.getElementById('enhancePromptBtn');
        const randomPromptBtn = document.getElementById('randomPromptBtn');
        const generateBtn = document.getElementById('generateBtn');
        const imageGrid = document.getElementById('imageGrid');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const messageModal = document.getElementById('messageModal');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalBtn = document.getElementById('closeModalBtn');

        // Function to show a message modal instead of alert()
        function showMessage(message) {
            modalMessage.textContent = message;
            messageModal.classList.add('show');
        }

        closeModalBtn.addEventListener('click', () => {
            messageModal.classList.remove('show');
        });

        // Predefined random prompts
        const randomPrompts = [
            "A whimsical forest where trees have glowing leaves and hidden creatures peek from behind mossy rocks.",
            "A futuristic city skyline at sunset, with flying cars and towering skyscrapers reflecting neon lights.",
            "An ancient dragon soaring over a volcanic landscape, smoke swirling around its wings.",
            "A serene Japanese garden with cherry blossoms, a koi pond, and a traditional pagoda.",
            "Astronauts playing zero-gravity basketball on the moon, with Earth visible in the background.",
            "A steampunk-inspired submarine exploring a vibrant underwater coral reef.",
            "A cozy hobbit hole nestled in a hillside, with smoke curling from its chimney.",
            "A magical library filled with ancient scrolls, floating books, and a wise owl perched on a bookshelf.",
            "A lone samurai warrior meditating under a cherry tree in a snow-covered landscape.",
            "A vibrant market bustling with alien vendors selling exotic fruits and strange gadgets."
        ];

        // Function to display loading state
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
            imageGrid.innerHTML = ''; // Clear previous images
            for (let i = 0; i < 4; i++) {
                const placeholder = document.createElement('div');
                placeholder.className = 'image-item';
                placeholder.textContent = 'Generating...';
                imageGrid.appendChild(placeholder);
            }
            generateBtn.disabled = true;
            enhancePromptBtn.disabled = true;
            randomPromptBtn.disabled = true;
            promptInput.disabled = true;
            styleSelect.disabled = true;
        }

        // Function to hide loading state
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
            generateBtn.disabled = false;
            enhancePromptBtn.disabled = false;
            randomPromptBtn.disabled = false;
            promptInput.disabled = false;
            styleSelect.disabled = false;
        }

        // Function to generate images
        async function generateImages() {
            const prompt = promptInput.value.trim();
            const style = styleSelect.value;

            if (!prompt) {
                showMessage("Please enter a prompt to generate images.");
                return;
            }

            showLoading();

            try {
                // Simulate API call to image generation LLM (imagen-3.0-generate-002)
                const payload = {
                    instances: { prompt: `${prompt}, style: ${style}` },
                    parameters: { "sampleCount": 4 } // Requesting 4 images
                };
                const apiKey = ""; // API key will be provided by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.predictions && result.predictions.length > 0) {
                    imageGrid.innerHTML = ''; // Clear placeholders
                    result.predictions.forEach(prediction => {
                        if (prediction.bytesBase64Encoded) {
                            const imageUrl = `data:image/png;base64,${prediction.bytesBase64Encoded}`;
                            const imgContainer = document.createElement('div');
                            imgContainer.className = 'image-item';
                            const img = document.createElement('img');
                            img.src = imageUrl;
                            img.alt = prompt;
                            img.onerror = () => {
                                imgContainer.innerHTML = 'Image failed to load.';
                            };
                            imgContainer.appendChild(img);
                            imageGrid.appendChild(imgContainer);
                        }
                    });
                } else {
                    showMessage("No images were generated. Please try a different prompt.");
                }
            } catch (error) {
                console.error("Error generating images:", error);
                showMessage("Failed to generate images. Please try again.");
            } finally {
                hideLoading();
            }
        }

        // Function to enhance the prompt
        async function enhancePrompt() {
            const currentPrompt = promptInput.value.trim();
            if (!currentPrompt) {
                showMessage("Please enter a prompt to enhance.");
                return;
            }

            // Temporarily disable buttons and show a subtle indicator
            enhancePromptBtn.textContent = 'Enhancing...';
            enhancePromptBtn.disabled = true;
            generateBtn.disabled = true;
            randomPromptBtn.disabled = true;

            try {
                // Simulate API call to text generation LLM (gemini-2.0-flash)
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Elaborate and enhance this image generation prompt, making it more descriptive and visually rich, suitable for a text-to-image AI: "${currentPrompt}". Provide only the enhanced prompt.` }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // API key will be provided by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const enhancedText = result.candidates[0].content.parts[0].text.trim();
                    // Clean up potential markdown formatting from LLM response
                    const cleanedText = enhancedText.replace(/^```json\n|\n```$/g, '').replace(/^```\n|\n```$/g, '');
                    promptInput.value = cleanedText;
                    showMessage("Prompt enhanced successfully!");
                } else {
                    showMessage("Failed to enhance prompt. Please try again.");
                }
            } catch (error) {
                console.error("Error enhancing prompt:", error);
                showMessage("Failed to enhance prompt. Please check your network connection.");
            } finally {
                enhancePromptBtn.textContent = 'Enhance Prompt';
                enhancePromptBtn.disabled = false;
                generateBtn.disabled = false;
                randomPromptBtn.disabled = false;
            }
        }

        // Function to set a random prompt
        function setRandomPrompt() {
            const randomIndex = Math.floor(Math.random() * randomPrompts.length);
            promptInput.value = randomPrompts[randomIndex];
            showMessage("Random prompt loaded!");
        }

        // Event Listeners
        generateBtn.addEventListener('click', generateImages);
        enhancePromptBtn.addEventListener('click', enhancePrompt);
        randomPromptBtn.addEventListener('click', setRandomPrompt);

        // Initial image placeholders on load
        window.onload = function() {
            imageGrid.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                const placeholder = document.createElement('div');
                placeholder.className = 'image-item';
                placeholder.innerHTML = `<svg class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-4 4 4 4-4v4zM6 9a1 1 0 11-2 0 1 1 0 012 0zm2-7a1 1 0 00-1 1v.01A1 1 0 007 3a1 1 0 001-1zm0 2a1 1 0 00-1 1v.01A1 1 0 007 5a1 1 0 001-1z" clip-rule="evenodd"></path></svg>`;
                imageGrid.appendChild(placeholder);
            }
        };
    </script>
</body>
</html>
