<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Weaver AI</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter Font Import */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Custom styles for button focus and active states */
        button:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.75); /* purple-300 with opacity */
        }

        button:active {
            transform: scale(0.95);
        }

        /* Basic spinner animation */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-800 via-blue-900 to-indigo-950 text-white flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">

    <div class="max-w-4xl w-full bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-2xl shadow-xl p-6 sm:p-8 lg:p-10 border border-purple-400 border-opacity-30">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-center mb-6 sm:mb-8 text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-pink-300">
            Dream Weaver AI
        </h1>
        <p class="text-lg text-center mb-8 text-purple-200">
            Unleash your creativity. Describe your vision, and we'll conjure it into reality.
        </p>

        <div class="mb-8">
            <textarea
                id="promptInput"
                class="w-full p-4 text-lg text-gray-800 bg-white bg-opacity-90 rounded-xl border-2 border-purple-500 focus:ring-4 focus:ring-purple-300 focus:border-transparent transition-all duration-300 shadow-inner resize-y min-h-[100px]"
                placeholder="Enter your vivid description here (e.g., 'A futuristic city at sunset, neon lights reflecting on wet streets, flying cars, cyberpunk style, highly detailed')..."
                rows="4"
            ></textarea>
        </div>

        <!-- Style Selection Dropdown -->
        <div class="mb-8 flex flex-col sm:flex-row justify-center items-center gap-4">
            <label for="imageStyleSelect" class="text-lg text-purple-200">Image Style:</label>
            <select
                id="imageStyleSelect"
                class="p-3 text-lg text-gray-800 bg-white bg-opacity-90 rounded-xl border-2 border-purple-500 focus:ring-4 focus:ring-purple-300 focus:border-transparent transition-all duration-300 shadow-inner"
            >
                <option value="Auto">Auto</option>
                <option value="Realistic">Realistic</option>
                <option value="Digital Art">Digital Art</option>
                <option value="Painting">Painting</option>
                <option value="Anime">Anime</option>
                <option value="3D Render">3D Render</option>
                <option value="Minimalist">Minimalist</option>
            </select>
        </div>

        <!-- Aspect Ratio Buttons -->
        <div class="mb-8 flex flex-col items-center">
            <span class="text-lg text-purple-200 mb-3">Aspect Ratio:</span>
            <div class="flex gap-4" id="aspectRatioButtons">
                <button data-ratio="1:1" class="px-6 py-2 rounded-lg text-lg font-medium transition-all duration-200 bg-purple-600 text-white shadow-md">
                    1:1
                </button>
                <button data-ratio="16:9" class="px-6 py-2 rounded-lg text-lg font-medium transition-all duration-200 bg-white bg-opacity-20 text-purple-100 hover:bg-opacity-30">
                    16:9
                </button>
                <button data-ratio="9:16" class="px-6 py-2 rounded-lg text-lg font-medium transition-all duration-200 bg-white bg-opacity-20 text-purple-100 hover:bg-opacity-30">
                    9:16
                </button>
            </div>
        </div>

        <div class="flex justify-center mb-8">
            <button
                id="generateButton"
                class="px-8 py-3 rounded-full text-xl font-semibold transition-all duration-300 transform bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 active:scale-95 shadow-lg hover:shadow-2xl focus:outline-none focus:ring-4 focus:ring-purple-300 focus:ring-opacity-75"
            >
                <span id="buttonText">Generate Images</span>
                <span id="loadingSpinner" class="hidden flex items-center">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Generating Dreams...
                </span>
            </button>
        </div>

        <div id="errorMessage" class="hidden bg-red-500 text-white p-4 rounded-xl mb-6 text-center shadow-md"></div>

        <div id="imageGallery" class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-8"></div>

        <div id="initialMessage" class="text-center text-purple-300 text-lg mt-8 p-6 bg-white bg-opacity-10 rounded-xl border border-purple-400 border-opacity-30">
            Your generated images will appear here. Start by typing a prompt above!
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const promptInput = document.getElementById('promptInput');
            const imageStyleSelect = document.getElementById('imageStyleSelect');
            const aspectRatioButtons = document.getElementById('aspectRatioButtons');
            const generateButton = document.getElementById('generateButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const errorMessageDiv = document.getElementById('errorMessage');
            const imageGallery = document.getElementById('imageGallery');
            const initialMessageDiv = document.getElementById('initialMessage');

            let selectedAspectRatio = '1:1'; // Default aspect ratio

            // Handle aspect ratio button clicks
            aspectRatioButtons.addEventListener('click', (event) => {
                const target = event.target;
                if (target.tagName === 'BUTTON') {
                    // Remove active class from all buttons
                    Array.from(aspectRatioButtons.children).forEach(btn => {
                        btn.classList.remove('bg-purple-600', 'text-white', 'shadow-md');
                        btn.classList.add('bg-white', 'bg-opacity-20', 'text-purple-100', 'hover:bg-opacity-30');
                    });

                    // Add active class to the clicked button
                    target.classList.remove('bg-white', 'bg-opacity-20', 'text-purple-100', 'hover:bg-opacity-30');
                    target.classList.add('bg-purple-600', 'text-white', 'shadow-md');
                    selectedAspectRatio = target.dataset.ratio;
                }
            });

            generateButton.addEventListener('click', async () => {
                setLoading(true);
                clearMessagesAndImages();

                const prompt = promptInput.value.trim();
                const imageStyle = imageStyleSelect.value;

                if (!prompt) {
                    displayErrorMessage('Please enter a prompt to generate images.');
                    setLoading(false);
                    return;
                }

                let width, height;
                switch (selectedAspectRatio) {
                    case '1:1':
                        width = 1024;
                        height = 1024;
                        break;
                    case '16:9':
                        width = 1024;
                        height = 576;
                        break;
                    case '9:16':
                        width = 576;
                        height = 1024;
                        break;
                    default:
                        width = 1024;
                        height = 1024;
                }

                const fullPrompt = imageStyle === 'Auto' ? prompt : `${prompt}, ${imageStyle}`;

                const payload = {
                    instances: { prompt: fullPrompt },
                    parameters: {
                        sampleCount: 4, // Generate 4 images
                        width: width,
                        height: height,
                    }
                };

                // The API key is left as an empty string; Canvas will provide it at runtime for imagen-3.0-generate-002
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.predictions && result.predictions.length > 0) {
                        result.predictions.forEach((prediction, index) => {
                            const imageUrl = `data:image/png;base64,${prediction.bytesBase64Encoded}`;
                            displayImage(imageUrl, index);
                        });
                    } else {
                        displayErrorMessage('No images were generated. Please try a different prompt.');
                    }
                } catch (error) {
                    console.error('Error generating images:', error);
                    displayErrorMessage('Failed to generate images. Please try again later.');
                } finally {
                    setLoading(false);
                }
            });

            function setLoading(isLoading) {
                if (isLoading) {
                    generateButton.disabled = true;
                    buttonText.classList.add('hidden');
                    loadingSpinner.classList.remove('hidden');
                    generateButton.classList.add('bg-gray-600', 'cursor-not-allowed', 'animate-pulse');
                    generateButton.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'hover:from-purple-700', 'hover:to-pink-700', 'active:scale-95', 'shadow-lg', 'hover:shadow-2xl');
                } else {
                    generateButton.disabled = false;
                    buttonText.classList.remove('hidden');
                    loadingSpinner.classList.add('hidden');
                    generateButton.classList.remove('bg-gray-600', 'cursor-not-allowed', 'animate-pulse');
                    generateButton.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'hover:from-purple-700', 'hover:to-pink-700', 'active:scale-95', 'shadow-lg', 'hover:shadow-2xl');
                }
            }

            function displayErrorMessage(message) {
                errorMessageDiv.textContent = message;
                errorMessageDiv.classList.remove('hidden');
            }

            function clearMessagesAndImages() {
                errorMessageDiv.classList.add('hidden');
                errorMessageDiv.textContent = '';
                imageGallery.innerHTML = '';
                initialMessageDiv.classList.add('hidden');
            }

            function displayImage(imageUrl, index) {
                const imageContainer = document.createElement('div');
                imageContainer.className = 'bg-white bg-opacity-15 p-4 rounded-xl shadow-lg border border-purple-400 border-opacity-40 transform hover:scale-105 transition-transform duration-300';
                imageContainer.innerHTML = `
                    <img
                        src="${imageUrl}"
                        alt="Generated Image ${index + 1}"
                        class="w-full h-auto rounded-lg object-cover shadow-md"
                        onerror="this.onerror=null;this.src='https://placehold.co/400x300/6A0DAD/ffffff?text=Image+Failed+to+Load';"
                    />
                `;
                imageGallery.appendChild(imageContainer);
            }
        });
    </script>
</body>
</html>
